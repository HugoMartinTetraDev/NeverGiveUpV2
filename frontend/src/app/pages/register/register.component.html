<div class="register-container">
  <div class="register-card">
    <div class="logo-section">
      <img src="assets/images/logo-pop-eat.png" alt="Logo Pop Eat" class="logo">
      <h1>PopEat</h1>
    </div>
    
    <h2>Créer un compte</h2>
    <p class="subtitle">Rejoignez notre communauté dès aujourd'hui</p>
    
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">Prénom</label>
          <input 
            type="text" 
            id="firstName" 
            formControlName="firstName" 
            placeholder="Entrez votre prénom"
            [ngClass]="{'is-invalid': registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched">
            <span *ngIf="registerForm.get('firstName')?.errors?.['required']">Le prénom est requis</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="lastName">Nom</label>
          <input 
            type="text" 
            id="lastName" 
            formControlName="lastName" 
            placeholder="Entrez votre nom"
            [ngClass]="{'is-invalid': registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched">
            <span *ngIf="registerForm.get('lastName')?.errors?.['required']">Le nom est requis</span>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="email">Email</label>
        <input 
          type="email" 
          id="email" 
          formControlName="email" 
          placeholder="Entrez votre email"
          [ngClass]="{'is-invalid': registerForm.get('email')?.invalid && registerForm.get('email')?.touched}"
        >
        <div class="error-message" *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
          <span *ngIf="registerForm.get('email')?.errors?.['required']">L'email est requis</span>
          <span *ngIf="registerForm.get('email')?.errors?.['email']">Veuillez entrer un email valide</span>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="password">Mot de passe</label>
          <input 
            type="password" 
            id="password" 
            formControlName="password" 
            placeholder="Entrez votre mot de passe"
            [ngClass]="{'is-invalid': registerForm.get('password')?.invalid && registerForm.get('password')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
            <span *ngIf="registerForm.get('password')?.errors?.['required']">Le mot de passe est requis</span>
            <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Le mot de passe doit contenir au moins 6 caractères</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirmer le mot de passe</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            placeholder="Confirmez votre mot de passe"
            [ngClass]="{'is-invalid': registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched">
            <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Veuillez confirmer votre mot de passe</span>
            <span *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']">Les mots de passe ne correspondent pas</span>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="phoneNumber">Numéro de téléphone</label>
        <input 
          type="tel" 
          id="phoneNumber" 
          formControlName="phoneNumber" 
          placeholder="Entrez votre numéro de téléphone"
          [ngClass]="{'is-invalid': registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched}"
        >
        <div class="error-message" *ngIf="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched">
          <span *ngIf="registerForm.get('phoneNumber')?.errors?.['pattern']">Veuillez entrer un numéro de téléphone valide</span>
        </div>
      </div>
      
      <div class="form-group">
        <label for="address">Adresse</label>
        <input 
          type="text" 
          id="address" 
          formControlName="address" 
          placeholder="Entrez votre adresse"
        >
      </div>
      
      <div class="form-group">
        <label for="birthDate">Date de naissance</label>
        <input 
          type="date" 
          id="birthDate" 
          formControlName="birthDate" 
          placeholder="JJ/MM/AAAA"
          [ngClass]="{'is-invalid': registerForm.get('birthDate')?.invalid && registerForm.get('birthDate')?.touched}"
        >
        <div class="error-message" *ngIf="registerForm.get('birthDate')?.invalid && registerForm.get('birthDate')?.touched">
          <span *ngIf="registerForm.get('birthDate')?.errors?.['required']">La date de naissance est requise</span>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="city">Ville</label>
          <input 
            type="text" 
            id="city" 
            formControlName="city" 
            placeholder="Entrez votre ville"
          >
        </div>
        
        <div class="form-group">
          <label for="zipCode">Code postal</label>
          <input 
            type="text" 
            id="zipCode" 
            formControlName="zipCode" 
            placeholder="Entrez votre code postal"
          >
        </div>
      </div>
      
      <div class="form-group roles-section">
        <label>Type de compte</label>
        <p class="roles-description">Sélectionnez un ou plusieurs types de compte :</p>
        
        <div class="roles-options">
          <div class="role-option">
            <input 
              type="checkbox" 
              id="role-customer" 
              [checked]="isRoleSelected(userRoles[0])" 
              (change)="onRoleChange(userRoles[0], $any($event.target).checked)"
            >
            <label for="role-customer">
              <span class="role-name">Client</span>
              <span class="role-description">Commander de la nourriture dans les restaurants</span>
            </label>
          </div>
          
          <div class="role-option">
            <input 
              type="checkbox" 
              id="role-restaurant" 
              [checked]="isRoleSelected(userRoles[1])" 
              (change)="onRoleChange(userRoles[1], $any($event.target).checked)"
            >
            <label for="role-restaurant">
              <span class="role-name">Restaurateur</span>
              <span class="role-description">Gérer votre restaurant et recevoir des commandes</span>
            </label>
          </div>
          
          <div class="role-option">
            <input 
              type="checkbox" 
              id="role-deliverer" 
              [checked]="isRoleSelected(userRoles[2])" 
              (change)="onRoleChange(userRoles[2], $any($event.target).checked)"
            >
            <label for="role-deliverer">
              <span class="role-name">Livreur</span>
              <span class="role-description">Livrer la nourriture aux clients</span>
            </label>
          </div>

          <div class="role-option" *ngIf="isDevelopmentMode">
            <input 
              type="checkbox" 
              id="role-developer" 
              [checked]="isRoleSelected(userRoles[3])" 
              (change)="onRoleChange(userRoles[3], $any($event.target).checked)"
            >
            <label for="role-developer">
              <span class="role-name">Développeur</span>
              <span class="role-description">Accès aux composants réutilisables</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Restaurant Owner Fields -->
      <div *ngIf="showRestaurantOwnerFields" class="role-specific-fields restaurant-fields">
        <h3>Informations du restaurant</h3>
        
        <div class="form-group">
          <label for="restaurantName">Nom du restaurant</label>
          <input 
            type="text" 
            id="restaurantName" 
            formControlName="restaurantName" 
            placeholder="Entrez le nom de votre restaurant"
            [ngClass]="{'is-invalid': registerForm.get('restaurantName')?.invalid && registerForm.get('restaurantName')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('restaurantName')?.invalid && registerForm.get('restaurantName')?.touched">
            <span *ngIf="registerForm.get('restaurantName')?.errors?.['required']">Le nom du restaurant est requis</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="restaurantDescription">Description du restaurant</label>
          <textarea 
            id="restaurantDescription" 
            formControlName="restaurantDescription" 
            placeholder="Décrivez votre restaurant"
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-group">
          <label for="siretNumber">Numéro SIRET</label>
          <input 
            type="text" 
            id="siretNumber" 
            formControlName="siretNumber" 
            placeholder="Entrez votre numéro SIRET"
            [ngClass]="{'is-invalid': registerForm.get('siretNumber')?.invalid && registerForm.get('siretNumber')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('siretNumber')?.invalid && registerForm.get('siretNumber')?.touched">
            <span *ngIf="registerForm.get('siretNumber')?.errors?.['required']">Le numéro SIRET est requis</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="restaurantAddress">Adresse du restaurant</label>
            <input 
              type="text" 
              id="restaurantAddress" 
              formControlName="restaurantAddress" 
              placeholder="Entrez l'adresse du restaurant"
              [ngClass]="{'is-invalid': registerForm.get('restaurantAddress')?.invalid && registerForm.get('restaurantAddress')?.touched}"
            >
            <div class="error-message" *ngIf="registerForm.get('restaurantAddress')?.invalid && registerForm.get('restaurantAddress')?.touched">
              <span *ngIf="registerForm.get('restaurantAddress')?.errors?.['required']">L'adresse du restaurant est requise</span>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="restaurantPhone">Téléphone du restaurant</label>
          <input 
            type="tel" 
            id="restaurantPhone" 
            formControlName="restaurantPhone" 
            placeholder="Enter restaurant phone number"
            [ngClass]="{'is-invalid': registerForm.get('restaurantPhone')?.invalid && registerForm.get('restaurantPhone')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('restaurantPhone')?.invalid && registerForm.get('restaurantPhone')?.touched">
            <span *ngIf="registerForm.get('restaurantPhone')?.errors?.['required']">Restaurant phone is required</span>
          </div>
        </div>

        
        <div class="form-group">
          <label for="deliveryFee">Frais de livraison (€)</label>
          <input 
            type="number" 
            id="deliveryFee" 
            formControlName="deliveryFee" 
            placeholder="Enter delivery fee"
            min="0"
            step="0.5"
            [ngClass]="{'is-invalid': registerForm.get('deliveryFee')?.invalid && registerForm.get('deliveryFee')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('deliveryFee')?.invalid && registerForm.get('deliveryFee')?.touched">
            <span *ngIf="registerForm.get('deliveryFee')?.errors?.['required']">Delivery fee is required</span>
          </div>
        </div>
      </div>
      
      <!-- Deliverer Fields -->
      <div *ngIf="showDelivererFields" class="role-specific-fields deliverer-fields">
        <h3>Informations du livreur</h3>
        
        <div class="form-group">
          <label for="delivererPhoneNumber">Numéro de téléphone professionnel</label>
          <input 
            type="tel" 
            id="delivererPhoneNumber" 
            formControlName="delivererPhoneNumber" 
            placeholder="Entrez votre numéro de téléphone professionnel"
            [ngClass]="{'is-invalid': registerForm.get('delivererPhoneNumber')?.invalid && registerForm.get('delivererPhoneNumber')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('delivererPhoneNumber')?.invalid && registerForm.get('delivererPhoneNumber')?.touched">
            <span *ngIf="registerForm.get('delivererPhoneNumber')?.errors?.['required']">Le numéro de téléphone est requis</span>
            <span *ngIf="registerForm.get('delivererPhoneNumber')?.errors?.['pattern']">Veuillez entrer un numéro de téléphone valide</span>
          </div>
        </div>

        <div class="form-group">
          <label for="delivererSiretNumber">Numéro SIRET</label>
          <input 
            type="text" 
            id="delivererSiretNumber" 
            formControlName="delivererSiretNumber" 
            placeholder="Entrez votre numéro SIRET"
            [ngClass]="{'is-invalid': registerForm.get('delivererSiretNumber')?.invalid && registerForm.get('delivererSiretNumber')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('delivererSiretNumber')?.invalid && registerForm.get('delivererSiretNumber')?.touched">
            <span *ngIf="registerForm.get('delivererSiretNumber')?.errors?.['required']">Le numéro SIRET est requis</span>
            <span *ngIf="registerForm.get('delivererSiretNumber')?.errors?.['pattern']">Le numéro SIRET doit contenir 14 chiffres</span>
          </div>
        </div>

        <div class="form-group">
          <label for="accountHolderName">Nom du titulaire du compte</label>
          <input 
            type="text" 
            id="accountHolderName" 
            formControlName="accountHolderName" 
            placeholder="Entrez le nom du titulaire du compte"
            [ngClass]="{'is-invalid': registerForm.get('accountHolderName')?.invalid && registerForm.get('accountHolderName')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('accountHolderName')?.invalid && registerForm.get('accountHolderName')?.touched">
            <span *ngIf="registerForm.get('accountHolderName')?.errors?.['required']">Le nom du titulaire du compte est requis</span>
          </div>
        </div>

        <div class="form-group">
          <label for="iban">IBAN</label>
          <input 
            type="text" 
            id="iban" 
            formControlName="iban" 
            placeholder="Entrez votre IBAN"
            [ngClass]="{'is-invalid': registerForm.get('iban')?.invalid && registerForm.get('iban')?.touched}"
          >
          <div class="error-message" *ngIf="registerForm.get('iban')?.invalid && registerForm.get('iban')?.touched">
            <span *ngIf="registerForm.get('iban')?.errors?.['required']">L'IBAN est requis</span>
            <span *ngIf="registerForm.get('iban')?.errors?.['pattern']">Veuillez entrer un IBAN valide</span>
          </div>
        </div>
      </div>
      
      <div class="error-alert" *ngIf="errorMessage">
        <div class="error-title">
          <i class="fa fa-exclamation-circle"></i> Erreur
        </div>
        <div class="error-content" [innerHTML]="formatErrorMessage(errorMessage)"></div>
      </div>
      
      <div class="error-alert" *ngIf="registerForm.invalid && registerForm.touched && !errorMessage">
        <div class="error-title">
          <i class="fa fa-exclamation-circle"></i> Champs requis manquants
        </div>
        <div class="error-content">
          Veuillez remplir tous les champs obligatoires pour continuer.
          <ul>
            <li *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched">Prénom</li>
            <li *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched">Nom</li>
            <li *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">Email</li>
            <li *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">Mot de passe</li>
            <li *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched">Confirmation de mot de passe</li>
            <li *ngIf="registerForm.get('address')?.invalid && registerForm.get('address')?.touched">Adresse</li>
            <li *ngIf="registerForm.get('birthDate')?.invalid && registerForm.get('birthDate')?.touched">Date de naissance</li>
            <li *ngIf="registerForm.get('roles')?.value.length === 0">Type de compte</li>
            <li *ngIf="showRestaurantOwnerFields && registerForm.get('restaurantName')?.invalid && registerForm.get('restaurantName')?.touched">Nom du restaurant</li>
            <li *ngIf="showRestaurantOwnerFields && registerForm.get('siretNumber')?.invalid && registerForm.get('siretNumber')?.touched">Numéro SIRET</li>
            <li *ngIf="showRestaurantOwnerFields && registerForm.get('restaurantAddress')?.invalid && registerForm.get('restaurantAddress')?.touched">Adresse du restaurant</li>
            <li *ngIf="showRestaurantOwnerFields && registerForm.get('restaurantPhone')?.invalid && registerForm.get('restaurantPhone')?.touched">Téléphone du restaurant</li>
            <li *ngIf="showRestaurantOwnerFields && registerForm.get('deliveryFee')?.invalid && registerForm.get('deliveryFee')?.touched">Frais de livraison</li>
            <li *ngIf="showDelivererFields && registerForm.get('delivererPhoneNumber')?.invalid && registerForm.get('delivererPhoneNumber')?.touched">Numéro de téléphone du livreur</li>
            <li *ngIf="showDelivererFields && registerForm.get('delivererSiretNumber')?.invalid && registerForm.get('delivererSiretNumber')?.touched">Numéro SIRET du livreur</li>
            <li *ngIf="showDelivererFields && registerForm.get('accountHolderName')?.invalid && registerForm.get('accountHolderName')?.touched">Nom du titulaire du compte</li>
            <li *ngIf="showDelivererFields && registerForm.get('iban')?.invalid && registerForm.get('iban')?.touched">IBAN</li>
          </ul>
        </div>
      </div>
      
      <div class="terms-agreement">
        By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-register" [disabled]="isLoading" (click)="onButtonClick()">
          <span *ngIf="!isLoading">S'inscrire</span>
          <span *ngIf="isLoading">Inscription en cours...</span>
        </button>
      </div>
    </form>
    
    <div class="login-link">
      Vous avez déjà un compte ? <a routerLink="/login">Se connecter</a>
    </div>
  </div>
</div> 